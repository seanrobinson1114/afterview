<!DOCTYPE html>
<html lang="en" ng-app="AfterView">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>AfterView</title>

    <!-- icon -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="js/node_modules/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/app.css">

    <!-- 3rd party files  -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA9_eGH_KivfuwfgXQWm1d3qVwdO3XVT0U"></script>
    <script src="js/node_modules/angular/angular.min.js"></script>
    <script src="js/node_modules/angular-animate/angular-animate.min.js"></script>
    <script src="js/node_modules/angular-ui-router/release/angular-ui-router.min.js"></script>
    <script src="js/node_modules/angular-ui-bootstrap/dist/ui-bootstrap-tpls.js "></script>
    <script src="js/node_modules/three/build/three.min.js"></script>
    <script src="js/node_modules/three/examples/js/controls/TrackballControls.js"></script>

    <!-- Project javascript files -->
    <script src="js/app.js"></script>
    <script src="js/states/PastTrips.js"></script>
    <script src="js/states/ProposedTrips.js"></script>
    <script src="js/states/InprogressTrips.js"></script>
    <script src="js/directives/PastTripsSelection.js"></script>
    <script src="js/directives/ImageGallery.js"></script>
    <script src="js/services/TripService.js"></script>
    <script src="js/services/PastTripsMap.js"></script>
    <script src="js/services/ScheduledTripsMap.js"></script>
    <script src="js/directives/RepeatDoneNotify.js"></script>
    <script src="js/services/UrlManager.js"></script>

    <!-- <script src="js/Globe.js"></script> -->

  </head>

  <header>
    <span class="title"> AfterView </span>
    <span class="version"> B.0.0.1 </span>

    <a ui-sref="pasttrips" id="pasttrips_link"><span class="glyphicon glyphicon-picture"></span> Past Trips </a>
    <a ui-sref="proposedtrips" id="proposedtrips_link"><span class="glyphicon glyphicon-calendar"></span> Proposed Trips </a>
    <a ui-sref="inprogresstrips" id="inprogresstrips_link"><span class="glyphicon glyphicon-road"></span> In Progress </a>
    <a id="login_link"></a>
  </header>

  <!-- <body onload="init();"> -->
  <body>

    <!-- <canvas id="canvas" width="300" height="300"></canvas> -->

    <!-- current rendered view base on selected route from navbar -->
    <div id="rendered_view" ui-view></div>

    <script>
      if( window.localStorage )
      {
        // Check for username and make request if it doesn't exist
        if( localStorage.getItem( 'username' ) == undefined )
        {
          // Create request and initialize
          let req = new XMLHttpRequest();
          req.open( 'GET', 'http://localhost:3000/uinf/uname', true );

          // Check if request is complete on any state change
          req.onreadystatechange = function()
          {
            console.log( 'checking for response from username request' );

            if( req.readyState === XMLHttpRequest.DONE && req.status === 200 )
            {
              localStorage.setItem( 'username', JSON.parse( req.responseText ) );
              document.getElementById( 'login_link' ).innerHTML = '<span class="glyphicon glyphicon-user"></span>' + JSON.parse( req.responseText );
            }
          };

          // Send request
          req.send();
        }
        else
          document.getElementById( 'login_link' ).innerHTML = '<span class="glyphicon glyphicon-user"></span>' + localStorage.getItem( 'username' );
      }

      // Attempt to get token from server if it doesn't exist
      if( !localStorage.getItem( 'token' ) )
      {
        // Create request for token
        let req = new XMLHttpRequest();
        req.open( 'GET', 'http://localhost:3000/getToken', true );

        // Check if request is complete on any state change
        req.onreadystatechange = function()
        {
          console.log( 'checking for response from token request' );

          if( req.readyState === XMLHttpRequest.DONE && req.status === 200 )
          {
            localStorage.setItem( 'token', JSON.parse( req.responseText ) );
          }
        };

        // Send request
        req.send();
      }
    </script>

  </body>

  <footer>
    <div class="center">
      <div class="footer-info">
        <div class="footer-header">AfterView</div>
        <a class="footer-github" href="https://github.com/seanrobinson1114" target="_blank">github</a>
      </div>
      <div id="contact-info">
        <div class="footer-header">Contact</div>
        <a class="email" href="mailto:seanrobinson1114@gmail.com">seanrobinson1114@gmail.com</a>
      </div>
    </div>
  </footer>

</html>
